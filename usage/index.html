<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://www.jkobject.com/scPRINT/usage/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>usage example - scprint</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../assets/_mkdocstrings.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "usage example";
        var mkdocs_page_input_path = "usage.md";
        var mkdocs_page_url = "/scPRINT/usage/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> scprint
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../structure/">structure</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../pretrain/">pre-training</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">usage example</a>
    <ul class="current">
    </ul>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">example notebooks</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../notebooks/cancer_usecase/">Cancer usecase</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../notebooks/cancer_usecase_part2/">Cancer usecase (part 2)</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">documentation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../model/">model</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tasks/">tasks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cli/">cli</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../embedder/">embedders</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../utils/">utils</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">scprint</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">usage example</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="scprint-usage">scPRINT usage</h1>
<p>scPRINT can be used to denoise / embed (&amp; predict labels) / infer gene networks on single-cell data.</p>
<p>Example of doing these tasks on a dataset is given in our manuscript and the <a href="../notebooks/cancer_usecase/">example notebooks</a>.</p>
<p>But in a nutshell, here is the most minimal example of how scPRINT works: </p>
<ol>
<li>once you have loaded an anndata object, make sure you preprocess it so everything is checked out. (number of genes mentioned, gene format, raw counts used, etc...) more information on the Preprocessor is available in the scDataLoader package ()</li>
<li>Then you can denoise / embed / infer gn on this anndata using scPRINT and its helper classes. These classes follow a similar pattern to the trainer class in pytorch-lightning.</li>
</ol>
<p>Here is an example for denoising:</p>
<pre><code class="language-py">from scprint import scPrint
from scdataloader import Preprocessor
import scanpy as sc
from scprint.tasks import Denoiser

#better to do it in lower precision
import torch
torch.set_float32_matmul_precision('medium')

adata = sc.read_h5ad(&quot;../data/temp.h5ad&quot;)
#make sure we have this metadata
adata.obs['organism_ontology_term_id'] = &quot;NCBITaxon:9606&quot;
# load the model
model = scPrint.load_from_checkpoint('../data/temp/last.ckpt', precpt_gene_emb=None)

# preprocess to make sure it looks good
preprocessor = Preprocessor(do_postp=False)
adata = preprocessor(adata)

#instanciate the denoiser with params (see the class in tasks/denoiser.py)
how=&quot;most var&quot;
denoiser = Denoiser(
    model,
    batch_size=20,
    max_len=2000,
    plot_corr_size=100_000,
    doplot=False,
    num_workers=1,
    predict_depth_mult=10,
    how=how,
    dtype=torch.bfloat16,
)
#denoise
metrics, idxs, genes, expr = denoise(model, adata)
print(metrics)

# apply the denoising to the anndata
adata.layers['before'] = adata.X.copy()
adata.X = adata.X.tolil()
idxs = idxs if idxs is not None else range(adata.shape[0])
for i, idx in enumerate(idxs):
    adata.X[
        idx,
        adata.var.index.get_indexer(
            np.array(model.genes)[genes[i]]
            if how != &quot;most var&quot;
            else genes
        ),
    ] = expr_pred[i]
adata.X = adata.X.tocsr()
</code></pre>
<p>But you can do the same thing with a bash command line:</p>
<pre><code class="language-bash">$ scprint denoise --ckpt_path ../data/temp/last.ckpt --adata ../data/temp.h5ad --how &quot;most var&quot; --dtype &quot;torch.bfloat16&quot; --batch_size 20 --max_len 2000 --plot_corr_size 100000 --num_workers 1 --predict_depth_mult 10 --doplot false --species &quot;NCBITaxon:9606&quot;
</code></pre>
<p>However in this context you might have somewhat less options for the preprocessing of the anndataset. However, all parameters of the denoiser, embedder and gninfer classes are available in the cli interface as well!</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../pretrain/" class="btn btn-neutral float-left" title="pre-training"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../notebooks/cancer_usecase/" class="btn btn-neutral float-right" title="Cancer usecase">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../pretrain/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../notebooks/cancer_usecase/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
